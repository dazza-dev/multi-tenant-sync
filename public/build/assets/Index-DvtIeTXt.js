import{u as L,B as X,y as S,L as c,E as q,o as P,c as M,w as l,b as t,X as R,h as B,t as V,m as z,H as k,Y,a as N,Z as ae,_ as le,$ as O,a0 as y,a1 as w,v as i,a2 as oe,a3 as Z,O as A,p as F,a4 as J,a5 as K,a6 as se,r as H,f as re,q as ne,a7 as U,a8 as G,n as W,a9 as de,F as ue,G as Q,aa as ie}from"./app-DCKOvwse.js";import{u as me}from"./i18nUtils-B75lBeJR.js";import{n as C,_ as ce,r as pe,g as fe}from"./UiParentCard.vue_vue_type_script_setup_true_lang-mCaMToJB.js";import{u as ve,r as D}from"./index-DRMB0St5.js";import{u as ee}from"./project-CO8GGf5Q.js";import"./axios-Dh4MC8Fy.js";const be={class:"title text-white"},ge={key:0},$e={key:1},Ve=L({__name:"Create",props:{projectId:Number,dialogEdit:Boolean},emits:["closeEditModal","refreshDatatable"],setup(u,{emit:f}){const b=u,v=f,{t:s}=X(),m=S(()=>j.value===-1?s("projects.newProject"):s("projects.editProject")),p=ee(),h=c(!0),g=c(!1),j=c(-1),r=c({name:"",logo:"",db_host:"",db_port:3306,db_database:"",db_username:"",db_password:"",raw_query:""}),E=c({name:"",logo:"",db_host:"",db_port:3306,db_database:"",db_username:"",db_password:"",raw_query:""});q([()=>b.dialogEdit,()=>b.projectId],([n,a],[e,$])=>{g.value=n,j.value=a??0,typeof a=="number"&&a>0&&g.value&&p.getProjectById(a).then(_=>{r.value=Object.assign({},_.data.project)})});const o=ve({name:{required:D},db_host:{required:D},db_database:{required:D},db_username:{required:D},db_password:{required:D},raw_query:{required:D}},r);function I(){g.value=!1,o.value.$reset(),v("closeEditModal"),setTimeout(()=>{r.value=Object.assign({},E.value),j.value=-1},300)}function T(){if(o.value.$invalid){C("error",s("common.fieldsValidationError"));return}j.value>-1?p.updateProject(j.value,r.value).then(n=>{I(),C("success",s("projects.updatedProjectSuccessfully")),v("refreshDatatable")}).catch(n=>{C("error",s("projects.errorUpdatingProject")+": "+n.message)}):p.createProject(r.value).then(n=>{I(),C("success",s("projects.createdProjectSuccessfully")),v("refreshDatatable")}).catch(n=>{C("error",s("projects.errorCreatingProject")+": "+n.message)})}return(n,a)=>(P(),M(K,{modelValue:g.value,"onUpdate:modelValue":a[8]||(a[8]=e=>g.value=e),"max-width":"800"},{activator:l(({props:e})=>[t(k,z({color:"primary"},e,{flat:"",class:"ml-auto"}),{default:l(()=>[t(R,{class:"mr-2"},{default:l(()=>a[9]||(a[9]=[B("mdi-plus")])),_:1}),B(" "+V(n.$t("projects.newProject")),1)]),_:2},1040)]),default:l(()=>[t(J,null,{default:l(()=>[t(Y,{class:"pa-4 bg-secondary"},{default:l(()=>[N("span",be,[t(R,{class:"mr-2"},{default:l(()=>a[10]||(a[10]=[B("mdi-plus")])),_:1}),B(" "+V(m.value),1)])]),_:1}),t(ae,null,{default:l(()=>[t(le,{ref:"form",modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=e=>h.value=e),"lazy-validation":""},{default:l(()=>[t(O,null,{default:l(()=>[t(y,{cols:"12",sm:"12"},{default:l(()=>[t(w,{variant:"outlined","hide-details":"",modelValue:r.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value.name=e),label:n.$t("projects.name"),onBlur:i(o).name.$touch,onInput:i(o).name.$touch,"error-messages":i(o).name.$errors.map(e=>e.$message)},null,8,["modelValue","label","onBlur","onInput","error-messages"])]),_:1}),t(y,{cols:"12",sm:"9"},{default:l(()=>[t(w,{variant:"outlined","hide-details":"",modelValue:r.value.db_host,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value.db_host=e),label:n.$t("projects.dbHost"),required:"",onBlur:i(o).db_host.$touch,onInput:i(o).db_host.$touch,"error-messages":i(o).db_host.$errors.map(e=>e.$message)},null,8,["modelValue","label","onBlur","onInput","error-messages"])]),_:1}),t(y,{cols:"12",sm:"3"},{default:l(()=>[t(w,{variant:"outlined","hide-details":"",modelValue:r.value.db_port,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.db_port=e),label:n.$t("projects.dbPort"),type:"number"},null,8,["modelValue","label"])]),_:1}),t(y,{cols:"12",sm:"12"},{default:l(()=>[t(w,{variant:"outlined","hide-details":"",modelValue:r.value.db_database,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.db_database=e),label:n.$t("projects.dbDatabaseName"),onBlur:i(o).db_database.$touch,onInput:i(o).db_database.$touch,"error-messages":i(o).db_database.$errors.map(e=>e.$message)},null,8,["modelValue","label","onBlur","onInput","error-messages"])]),_:1}),t(y,{cols:"12",sm:"12"},{default:l(()=>[t(w,{variant:"outlined","hide-details":"",modelValue:r.value.db_username,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value.db_username=e),label:n.$t("projects.dbUserName"),autocomplete:"new-username",onBlur:i(o).db_username.$touch,onInput:i(o).db_username.$touch,"error-messages":i(o).db_username.$errors.map(e=>e.$message)},null,8,["modelValue","label","onBlur","onInput","error-messages"])]),_:1}),t(y,{cols:"12",sm:"12"},{default:l(()=>[t(w,{variant:"outlined","hide-details":"",type:"password",modelValue:r.value.db_password,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value.db_password=e),label:n.$t("projects.dbPassword"),autocomplete:"new-password",onBlur:i(o).db_password.$touch,onInput:i(o).db_password.$touch,"error-messages":i(o).db_password.$errors.map(e=>e.$message)},null,8,["modelValue","label","onBlur","onInput","error-messages"])]),_:1}),t(y,{cols:"12",sm:"12"},{default:l(()=>[t(oe,{variant:"outlined","hide-details":"",modelValue:r.value.raw_query,"onUpdate:modelValue":a[6]||(a[6]=e=>r.value.raw_query=e),label:n.$t("projects.rawQuery"),onBlur:i(o).raw_query.$touch,onInput:i(o).raw_query.$touch,"error-messages":i(o).raw_query.$errors.map(e=>e.$message)},null,8,["modelValue","label","onBlur","onInput","error-messages"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Z,{class:"pa-4"},{default:l(()=>[t(A),t(k,{color:"error",onClick:I},{default:l(()=>[B(V(n.$t("cancel")),1)]),_:1}),t(k,{color:"secondary",disabled:r.value.name=="",variant:"flat",onClick:T},{default:l(()=>[j.value===-1?(P(),F("span",ge,V(n.$t("save")),1)):(P(),F("span",$e,V(n.$t("update")),1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),he=L({__name:"DeleteModal",props:{show:Boolean,title:String,confirmButtonText:String,cancelButtonText:String},emits:["close","confirm"],setup(u,{emit:f}){const b=u,v=S(()=>b.show);return(s,m)=>(P(),M(K,{modelValue:v.value,"onUpdate:modelValue":m[2]||(m[2]=p=>v.value=p),"max-width":"500px"},{default:l(()=>[t(J,null,{default:l(()=>[t(Y,{class:"text-h5 text-center py-6"},{default:l(()=>[B(V(u.title),1)]),_:1}),t(Z,null,{default:l(()=>[t(A),t(k,{color:"error",variant:"flat",dark:"",onClick:m[0]||(m[0]=p=>s.$emit("close"))},{default:l(()=>[B(V(u.cancelButtonText),1)]),_:1}),t(k,{color:"success",variant:"flat",dark:"",onClick:m[1]||(m[1]=p=>s.$emit("confirm"))},{default:l(()=>[B(V(u.confirmButtonText),1)]),_:1}),t(A)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),je=L({__name:"DataTable",props:{tableClass:{type:String,default:"border rounded-md mt-5"},headers:Array|Object,items:Array|Object,loading:{type:Boolean,default:!1},itemValue:{type:String,default:"id"},totalItems:{type:Number,default:0},itemsPerPage:{type:Number,default:10},search:String,deleteButtonText:String,deleteModalTitle:String,deleteModalConfirmButtonText:String,deleteModalCancelButtonText:String,editButtonText:String},emits:["onLoadData","editItem","deleteItem"],setup(u,{emit:f}){const b=u,v=f,s=c(b.itemsPerPage),m=c([]),p=c(0),h=c(null),g=c(!1),j=S(()=>b.headers.filter(a=>a.key!=="actions"));se(()=>{T({page:p.value,itemsPerPage:s.value})});const r=a=>{h.value=a,g.value=!0},E=()=>{h.value=null,g.value=!1},o=a=>{v("editItem",a)},I=()=>{v("deleteItem",h),g.value=!1},T=({page:a,itemsPerPage:e})=>{p.value=a;const $=m.value.map(_=>({column:_.key,direction:_.order}));v("onLoadData",{page:a,itemsPerPage:e,search:b.search,sortBy:$})},n=()=>{T({page:0,itemsPerPage:s.value})};return q(()=>b.search,(a,e)=>{a!==e&&T({page:0,itemsPerPage:s.value})}),q(s,(a,e)=>{a!==e&&T({page:0,itemsPerPage:a})}),q(m,(a,e)=>{T({page:0,itemsPerPage:s.value})}),(a,e)=>{const $=H("PencilIcon"),_=H("TrashIcon");return P(),F(ue,null,[t(de,{headers:u.headers,items:u.items,loading:u.loading,"items-length":u.totalItems,"items-per-page":s.value,"onUpdate:itemsPerPage":e[0]||(e[0]=d=>s.value=d),search:u.search,onSearch:n,"sort-by":m.value,"onUpdate:sortBy":e[1]||(e[1]=d=>m.value=d),"item-value":u.itemValue,class:W(u.tableClass)},re({"item.actions":l(({item:d})=>[U(a.$slots,"before-actions",{item:d}),t(G,{text:u.editButtonText},{activator:l(({props:x})=>[t(k,z({icon:"",flat:"",onClick:te=>o(d)},x),{default:l(()=>[t($,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),t(G,{text:u.deleteButtonText},{activator:l(({props:x})=>[t(k,z({icon:"",flat:"",onClick:te=>r(d)},x),{default:l(()=>[t(_,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),U(a.$slots,"after-actions",{item:d})]),tfoot:l(()=>[N("tfoot",null,[U(a.$slots,"item.tfoot")])]),_:2},[ne(j.value,d=>({name:`item.${d.key}`,fn:l(({item:x})=>[U(a.$slots,`item.${d.key}`,{item:x},()=>[B(V(x[d.key]),1)])])}))]),1032,["headers","items","loading","items-length","items-per-page","search","sort-by","item-value","class"]),t(he,{show:g.value,title:u.deleteModalTitle,confirmButtonText:u.deleteModalConfirmButtonText,cancelButtonText:u.deleteModalCancelButtonText,onClose:E,onConfirm:I},null,8,["show","title","confirmButtonText","cancelButtonText"])],64)}}}),ye={class:"ml-4"},Be={class:"text-h6"},ke=L({__name:"Index",setup(u){const{t:f}=X(),b=c({title:f("projects.pageTitle")});document.title=b.value.title;const v=c([]),s=ee(),m=c(!1),p=c(-1),h=c(""),g=S(()=>s.projects),j=S(()=>s.loading),r=S(()=>s.totalItems);me(()=>{b.value={title:f("projects.pageTitle")},v.value=[{title:f("projects.tableHeaderName"),align:"start",key:"name"},{title:f("projects.tableHeaderEndPoint"),align:"start",key:"db_host"},{title:f("common.actions"),key:"actions",sortable:!1}]});const o=()=>{I()},I=()=>{s.getProjects()};function T(e){p.value=e.id,m.value=!0}function n(){p.value=-1,m.value=!1}function a(e){s.deleteProject(e.value.id).then($=>{o(),C("success",f("projects.deletedProjectSuccessfully"))}).catch($=>{C("error",f("projects.errorDeletingProject")+": "+$.message)})}return(e,$)=>{const _=H("RouterLink");return P(),M(O,null,{default:l(()=>[t(y,{cols:"12"},{default:l(()=>[t(ce,{title:e.$t("projects.tableTitle")},{default:l(()=>[t(O,null,{default:l(()=>[t(y,{cols:"12",lg:"4",md:"6"},{default:l(()=>[t(w,{density:"compact",modelValue:h.value,"onUpdate:modelValue":$[0]||($[0]=d=>h.value=d),label:e.$t("projects.searchProject"),"prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":""},null,8,["modelValue","label"])]),_:1}),t(y,{cols:"12",lg:"8",md:"6",class:"text-right"},{default:l(()=>[t(Ve,{projectId:p.value,dialogEdit:m.value,onCloseEditModal:n,onRefreshDatatable:$[1]||($[1]=d=>o())},null,8,["projectId","dialogEdit"])]),_:1})]),_:1}),t(je,{headers:v.value,items:g.value,loading:j.value,search:h.value,totalItems:r.value,onOnLoadData:I,onEditItem:T,onDeleteItem:a,deleteButtonText:e.$t("common.delete"),deleteModalTitle:i(f)("projects.deleteConfirmation"),deleteModalConfirmButtonText:e.$t("common.confirmDelete"),deleteModalCancelButtonText:e.$t("common.cancel"),editButtonText:e.$t("common.edit")},{"item.name":l(({item:d})=>[t(_,{to:{name:"project",params:{projectId:d.id}},class:"d-flex align-center text-decoration-none text-body-1 font-weight-medium"},{default:l(()=>[d.logo?(P(),M(Q,{key:0,size:"35"},{default:l(()=>[t(ie,{alt:d.name,src:d.logo},null,8,["alt","src"])]),_:2},1024)):(P(),M(Q,{key:1,size:"35",class:W("ml-n2 avtar-border bg-"+i(pe)())},{default:l(()=>[B(V(i(fe)(d.name)),1)]),_:2},1032,["class"])),N("div",ye,[N("h6",Be,V(d.name),1)])]),_:2},1032,["to"])]),_:1},8,["headers","items","loading","search","totalItems","deleteButtonText","deleteModalTitle","deleteModalConfirmButtonText","deleteModalCancelButtonText","editButtonText"])]),_:1},8,["title"])]),_:1})]),_:1})}}});export{ke as default};
